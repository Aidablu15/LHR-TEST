<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>LHR Globe Route Map</title>

<!-- Three.js + Globe.js CDN -->
<script src="https://unpkg.com/three@0.160.0/build/three.min.js"></script>
<script src="https://unpkg.com/three-globe"></script>
<script src="https://unpkg.com/d3@7"></script>
<script src="https://unpkg.com/topojson-client@3"></script>

<style>
  body { margin:0; overflow:hidden; background: #000; font-family: sans-serif; }
  #globe-container { width:100vw; height:100vh; }
  .tooltip {
    position:absolute;
    background: rgba(0,0,0,0.75);
    color:#fff;
    padding:6px 10px;
    border-radius:6px;
    pointer-events:none;
    font-size:13px;
    font-weight:500;
    white-space:nowrap;
    display:none;
    z-index:10;
  }
</style>
</head>
<body>
<div id="globe-container"></div>
<div class="tooltip" id="tooltip"></div>

<script>
  // -----------------------------
  // 1) Destinations list
  // -----------------------------
  const DESTINATIONS = [
    { name: "Aberdeen International Airport", iata: "ABZ", coords: [57.201, -2.197], region: "Europe", country: "UK" },
    { name: "Amsterdam Schiphol Airport", iata: "AMS", coords: [52.308, 4.763], region: "Europe", country: "Netherlands" },
    { name: "Athens International Airport", iata: "ATH", coords: [37.936, 23.944], region: "Europe", country: "Greece" },
    { name: "New York JFK", iata: "JFK", coords: [40.6413, -73.7781], region: "Americas", country: "USA" },
    { name: "Los Angeles LAX", iata: "LAX", coords: [33.9416, -118.4085], region: "Americas", country: "USA" },
    { name: "Tokyo Haneda HND", iata: "HND", coords: [35.5494, 139.7798], region: "Asia", country: "Japan" },
    { name: "Singapore SIN", iata: "SIN", coords: [1.3644, 103.9915], region: "Asia", country: "Singapore" },
    { name: "Johannesburg JNB", iata: "JNB", coords: [-26.1367, 28.2410], region: "Africa", country: "South Africa" },
    { name: "Cape Town CPT", iata: "CPT", coords: [-33.9696, 18.5972], region: "Africa", country: "South Africa" },
    { name: "Sydney SYD", iata: "SYD", coords: [-33.9399, 151.1753], region: "Oceania", country: "Australia" },
    { name: "Auckland AKL", iata: "AKL", coords: [-37.0082, 174.7850], region: "Oceania", country: "New Zealand" }
  ];

  const HUB = { name: "London Heathrow", iata:"LHR", coords:[51.4700, -0.4543] };

  // -----------------------------
  // 2) Three.js scene
  // -----------------------------
  const container = document.getElementById('globe-container');
  const scene = new THREE.Scene();
  const camera = new THREE.PerspectiveCamera(50, window.innerWidth/window.innerHeight, 0.1, 2000);
  camera.position.z = 400;

  const renderer = new THREE.WebGLRenderer({ antialias:true });
  renderer.setSize(window.innerWidth, window.innerHeight);
  container.appendChild(renderer.domElement);

  // -----------------------------
  // 3) Globe
  // -----------------------------
  const Globe = new ThreeGlobe({ 
    showAtmosphere: true,
    atmosphereColor: 'lightskyblue',
    atmosphereAltitude: 0.25
  })
  .globeImageUrl('//unpkg.com/three-globe/example/img/earth-dark.jpg')  // dark style globe
  .bumpImageUrl('//unpkg.com/three-globe/example/img/earth-topology.png')
  .pointsData([HUB, ...DESTINATIONS].map(d=>({
    lat: d.coords[0],
    lng: d.coords[1],
    size: d === HUB ? 2.5 : 1.2,
    color: d === HUB ? 'orange' : '#0ea5e9',
    name: d.name,
    iata: d.iata,
    region: d.region,
    country: d.country
  })))
  .pointAltitude('size')
  .pointColor('color')
  .pointLabel(d=>`${d.name} (${d.iata})`);

  scene.add(Globe);

  // -----------------------------
  // 4) Routes (great-circle arcs)
  // -----------------------------
  const arcs = DESTINATIONS.map(d => ({
    startLat: HUB.coords[0],
    startLng: HUB.coords[1],
    endLat: d.coords[0],
    endLng: d.coords[1],
    color: 'rgba(34,211,238,0.8)',
    dashLength: 0.5,
    arcAltitude: 0.2
  }));
  Globe.arcsData(arcs)
    .arcColor('color')
    .arcDashLength('dashLength')
    .arcDashGap(0.1)
    .arcDashInitialGap(() => Math.random())
    .arcDashAnimateTime(3000)
    .arcAltitude('arcAltitude');

  // -----------------------------
  // 5) Tooltip
  // -----------------------------
  const tooltip = document.getElementById('tooltip');
  let mouse = new THREE.Vector2();

  window.addEventListener('mousemove', e => {
    mouse.x = (e.clientX / window.innerWidth) * 2 - 1;
    mouse.y = - (e.clientY / window.innerHeight) * 2 + 1;
  });

  const raycaster = new THREE.Raycaster();

  function updateTooltip() {
    raycaster.setFromCamera(mouse, camera);
    const intersects = raycaster.intersectObjects(Globe.pointsData().map(p=>p.__threeObj).filter(Boolean));
    if (intersects.length) {
      const obj = intersects[0].object.__data;
      tooltip.style.display='block';
      tooltip.style.left = (event.clientX+10)+'px';
      tooltip.style.top = (event.clientY+10)+'px';
      tooltip.innerHTML = `<strong>${obj.name} (${obj.iata})</strong><br>${obj.region} - ${obj.country}`;
    } else {
      tooltip.style.display='none';
    }
  }

  // -----------------------------
  // 6) Controls (orbit)
  // -----------------------------
  const controls = new THREE.OrbitControls(camera, renderer.domElement);
  controls.enableZoom = true;
  controls.enablePan = false;
  controls.minDistance = 200;
  controls.maxDistance = 800;

  // -----------------------------
  // 7) Animate
  // -----------------------------
  function animate() {
    requestAnimationFrame(animate);
    controls.update();
    updateTooltip();
    renderer.render(scene, camera);
  }
  animate();

  // Resize
  window.addEventListener('resize', ()=> {
    camera.aspect = window.innerWidth/window.innerHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(window.innerWidth, window.innerHeight);
  });
</script>

<!-- OrbitControls -->
<script src="https://unpkg.com/three@0.160.0/examples/js/controls/OrbitControls.js"></script>
</body>
</html>
